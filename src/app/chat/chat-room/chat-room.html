<app-nav></app-nav>
<div class="chat-layout" style="display: flex; height: 100vh;">
  <app-chat-list
    [users]="users"
    [selectedUserId]="selectedUser?._id || null"
    (selectedUser)="onUserSelected($event)"
    style="width: 25%; border-right: 1px solid #ccc;"
  ></app-chat-list>

  <div style="flex: 1; padding: 16px;">
    <ng-container *ngIf="selectedUser; else noSelection">
      <h2>Chat with {{ selectedUser.username }}</h2>

      <!-- Chat message list -->
      <div *ngFor="let msg of filteredMessages" style="margin-bottom: 10px;">
        <b>{{ msg.senderId === currentUserId ? 'You' : selectedUser.username }}:</b>
        {{ msg.content }}
        <br />
        <small style="color: gray;">{{ msg.timestamp | date: 'shortTime' }}</small>
      </div>

      <!-- Chat form -->
      <form [formGroup]="chatForm" (ngSubmit)="sendMessage()" style="margin-top: 20px;">
        <input
          type="text"
          formControlName="message"
          placeholder="Type a message..."
          style="padding: 8px; width: 70%;"
        />
        <button type="submit" style="padding: 8px;">Send</button>
        <div *ngIf="chatForm.controls.message.touched && chatForm.controls.message.invalid" style="color: red;">
          Message is required
        </div>
      </form>
    </ng-container>

    <ng-template #noSelection>
      <p>Please select a user to see chat messages.</p>
    </ng-template>
  </div>
</div>
